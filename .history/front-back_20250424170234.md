è¿˜è®°å¾—æˆ‘ä»¬åœ¨å¼€å‘çš„é‚£ä¸ªBOçš„å¾®æœåŠ¡å‰ç«¯å—ï¼Ÿæˆ‘æƒ³æŠŠè¿™ä¸ªBOç³»ç»Ÿè·Ÿcanvasç‹¬ç«‹å¼€ï¼Œä½†æ˜¯æ–¹ä¾¿canvasè°ƒç”¨ã€‚æˆ‘å†™çš„å¾…å¼€å‘çš„åç«¯è·Ÿå·²ç»å¼€å‘çš„å‰ç«¯çš„æ¥å£å¦‚ä¸‹ï¼š
### å‰ç«¯ä¸åç«¯æ¥å£æ€»ç»“ front

åŸºäºæ‚¨æä¾›çš„åç«¯ç³»ç»Ÿç»“æ„ï¼Œä»¥ä¸‹æ˜¯å‰ç«¯ï¼ˆBOä¼˜åŒ–å™¨GUIï¼‰å’Œåç«¯ï¼ˆFastAPI BOå¼•æ“ï¼‰ä¹‹é—´éœ€è¦çš„ä¸»è¦æ¥å£ï¼š

## 1. å‚æ•°ç©ºé—´é…ç½®æ¥å£

### 1.1 åˆ›å»º/åˆå§‹åŒ–å‚æ•°ç©ºé—´

```plaintext
POST /api/parameter-space
```

- **åŠŸèƒ½**ï¼šåˆ›å»ºæ–°çš„ä¼˜åŒ–ä»»åŠ¡ï¼Œå®šä¹‰å‚æ•°ç©ºé—´
- **è¯·æ±‚ä½“**ï¼š

```json
{
  "name": "ä¼˜åŒ–ä»»åŠ¡åç§°",
  "parameters": [
    {
      "name": "x1",
      "type": "continuous",
      "min": 0,
      "max": 1
    },
    {
      "name": "x2",
      "type": "categorical",
      "values": ["A", "B", "C"]
    },
    {
      "name": "x3",
      "type": "discrete",
      "min": 1,
      "max": 10,
      "step": 1
    }
  ],
  "objectives": [
    {
      "name": "y1",
      "type": "maximize"
    },
    {
      "name": "y2",
      "type": "minimize"
    }
  ],
  "constraints": [
    {
      "expression": "x1 + x2",
      "type": "sum_equals",
      "value": 1
    }
  ]
}
```


- **å“åº”**ï¼š

```json
{
  "task_id": "12345",
  "status": "created",
  "message": "å‚æ•°ç©ºé—´åˆ›å»ºæˆåŠŸ"
}
```




### 1.2 è·å–å‚æ•°ç©ºé—´é…ç½®

```plaintext
GET /api/parameter-space/{task_id}
```

- **åŠŸèƒ½**ï¼šè·å–å·²å®šä¹‰çš„å‚æ•°ç©ºé—´é…ç½®
- **å“åº”**ï¼šå®Œæ•´çš„å‚æ•°ç©ºé—´é…ç½®


### 1.3 æ›´æ–°å‚æ•°ç©ºé—´

```plaintext
PUT /api/parameter-space/{task_id}
```

- **åŠŸèƒ½**ï¼šæ›´æ–°ç°æœ‰å‚æ•°ç©ºé—´çš„é…ç½®
- **è¯·æ±‚ä½“**ï¼šä¸åˆ›å»ºç±»ä¼¼ï¼Œä½†å¯ä»¥éƒ¨åˆ†æ›´æ–°


## 2. ä¼˜åŒ–ç­–ç•¥é…ç½®æ¥å£

### 2.1 è®¾ç½®ä¼˜åŒ–ç­–ç•¥

```plaintext
POST /api/strategy/{task_id}
```

- **åŠŸèƒ½**ï¼šé…ç½®ä¼˜åŒ–ç®—æ³•å’Œç­–ç•¥
- **è¯·æ±‚ä½“**ï¼š

```json
{
  "algorithm": "bayesian",
  "config": {
    "acquisition_function": "ei",
    "kernel": "matern",
    "exploration_weight": 0.5,
    "noise_level": 0.1,
    "multi_objective": true,
    "moo_acquisition": "ehvi",
    "noisy_moo": true
  },
  "initial_sampling": {
    "method": "lhs",
    "samples": 10
  },
  "batch_size": 5,
  "iterations": 20
}
```


- **å“åº”**ï¼šç¡®è®¤ç­–ç•¥å·²è®¾ç½®


### 2.2 è·å–ä¼˜åŒ–ç­–ç•¥

```plaintext
GET /api/strategy/{task_id}
```

- **åŠŸèƒ½**ï¼šè·å–å½“å‰é…ç½®çš„ä¼˜åŒ–ç­–ç•¥
- **å“åº”**ï¼šå½“å‰ç­–ç•¥é…ç½®


## 3. å®éªŒè®¾è®¡ä¸ç»“æœæ¥å£

### 3.1 è·å–åˆå§‹å®éªŒè®¾è®¡

```plaintext
GET /api/designs/{task_id}/initial
```

- **åŠŸèƒ½**ï¼šè·å–åˆå§‹å®éªŒè®¾è®¡ç‚¹
- **å“åº”**ï¼š

```json
{
  "designs": [
    {
      "id": "design_1",
      "parameters": {"x1": 0.2, "x2": "A", "x3": 5}
    },
    {
      "id": "design_2",
      "parameters": {"x1": 0.8, "x2": "B", "x3": 3}
    }
  ]
}
```




### 3.2 æäº¤å®éªŒç»“æœ

```plaintext
POST /api/results/{task_id}
```

- **åŠŸèƒ½**ï¼šæäº¤å®éªŒç»“æœ
- **è¯·æ±‚ä½“**ï¼š

```json
{
  "results": [
    {
      "design_id": "design_1",
      "objectives": {"y1": 0.75, "y2": 0.25},
      "metadata": {
        "timestamp": "2023-06-15T10:30:00Z",
        "experimenter": "ç”¨æˆ·å",
        "notes": "å®éªŒå¤‡æ³¨"
      }
    }
  ]
}
```


- **å“åº”**ï¼šç¡®è®¤ç»“æœå·²æ¥æ”¶


### 3.3 è·å–ä¸‹ä¸€æ‰¹å®éªŒè®¾è®¡

```plaintext
GET /api/designs/{task_id}/next
```

- **åŠŸèƒ½**ï¼šè·å–ä¸‹ä¸€æ‰¹æ¨èçš„å®éªŒè®¾è®¡ç‚¹
- **æŸ¥è¯¢å‚æ•°**ï¼š

- `batch_size`: éœ€è¦çš„è®¾è®¡ç‚¹æ•°é‡
- `strategy`: å¯é€‰çš„æ‰¹é‡ç­–ç•¥ï¼ˆå¦‚"qei"ã€"kb"ç­‰ï¼‰



- **å“åº”**ï¼š

```json
{
  "designs": [
    {
      "id": "design_10",
      "parameters": {"x1": 0.4, "x2": "C", "x3": 7},
      "predictions": {
        "y1": {"mean": 0.85, "std": 0.05},
        "y2": {"mean": 0.15, "std": 0.03}
      },
      "uncertainty": 0.04,
      "reason": "é«˜é¢„æœŸæ”¹è¿›å€¼ï¼Œä½ä¸ç¡®å®šæ€§"
    }
  ]
}
```




## 4. æ¨¡å‹ä¸åˆ†ææ¥å£

### 4.1 è·å–æ¨¡å‹é¢„æµ‹

```plaintext
POST /api/predict/{task_id}
```

- **åŠŸèƒ½**ï¼šè·å–æ¨¡å‹å¯¹æŒ‡å®šå‚æ•°ç»„åˆçš„é¢„æµ‹
- **è¯·æ±‚ä½“**ï¼š

```json
{
  "parameters": [
    {"x1": 0.5, "x2": "A", "x3": 5},
    {"x1": 0.6, "x2": "B", "x3": 6}
  ]
}
```


- **å“åº”**ï¼š

```json
{
  "predictions": [
    {
      "parameters": {"x1": 0.5, "x2": "A", "x3": 5},
      "objectives": {
        "y1": {"mean": 0.8, "std": 0.05},
        "y2": {"mean": 0.2, "std": 0.03}
      }
    }
  ]
}
```




### 4.2 è·å–æ¨¡å‹æ€§èƒ½æŒ‡æ ‡

```plaintext
GET /api/model/{task_id}/performance
```

- **åŠŸèƒ½**ï¼šè·å–å½“å‰æ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡
- **å“åº”**ï¼š

```json
{
  "metrics": {
    "r2": 0.92,
    "rmse": 0.08,
    "mae": 0.06
  },
  "cross_validation": {
    "cv_scores": [0.91, 0.93, 0.90, 0.94, 0.92],
    "mean_score": 0.92,
    "std_score": 0.015
  }
}
```




### 4.3 è·å–Paretoå‰æ²¿

```plaintext
GET /api/pareto/{task_id}
```

- **åŠŸèƒ½**ï¼šè·å–å¤šç›®æ ‡ä¼˜åŒ–çš„Paretoå‰æ²¿
- **å“åº”**ï¼š

```json
{
  "pareto_front": [
    {
      "id": "design_5",
      "parameters": {"x1": 0.3, "x2": "B", "x3": 4},
      "objectives": {"y1": 0.9, "y2": 0.3},
      "uncertainty": 0.02
    }
  ],
  "dominated_solutions": [...],
  "ideal_point": {"y1": 1.0, "y2": 0.0},
  "nadir_point": {"y1": 0.5, "y2": 0.8}
}
```




### 4.4 è·å–ä¸ç¡®å®šæ€§åˆ†æ

```plaintext
GET /api/uncertainty/{task_id}
```

- **åŠŸèƒ½**ï¼šè·å–é¢„æµ‹ä¸å®é™…æµ‹é‡å€¼çš„å…³ç³»åˆ†æ
- **å“åº”**ï¼š

```json
{
  "prediction_vs_actual": [
    {
      "design_id": "design_1",
      "predicted": {"mean": 0.8, "std": 0.05},
      "actual": 0.75,
      "error": 0.05,
      "within_confidence": true
    }
  ],
  "calibration_metrics": {
    "coverage_probability": 0.95,
    "sharpness": 0.08
  }
}
```




## 5. ä»»åŠ¡ç®¡ç†æ¥å£

### 5.1 è·å–ä»»åŠ¡åˆ—è¡¨

```plaintext
GET /api/tasks
```

- **åŠŸèƒ½**ï¼šè·å–æ‰€æœ‰ä¼˜åŒ–ä»»åŠ¡åˆ—è¡¨
- **å“åº”**ï¼šä»»åŠ¡IDå’ŒåŸºæœ¬ä¿¡æ¯åˆ—è¡¨


### 5.2 è·å–ä»»åŠ¡çŠ¶æ€

```plaintext
GET /api/tasks/{task_id}/status
```

- **åŠŸèƒ½**ï¼šè·å–ç‰¹å®šä»»åŠ¡çš„å½“å‰çŠ¶æ€
- **å“åº”**ï¼š

```json
{
  "status": "running",
  "current_iteration": 15,
  "total_iterations": 20,
  "best_result": {
    "parameters": {"x1": 0.4, "x2": "C", "x3": 7},
    "objectives": {"y1": 0.92, "y2": 0.18}
  },
  "last_updated": "2023-06-15T14:30:00Z"
}
```




### 5.3 å¯¼å‡ºä»»åŠ¡æ•°æ®

```plaintext
GET /api/tasks/{task_id}/export
```

- **åŠŸèƒ½**ï¼šå¯¼å‡ºä»»åŠ¡çš„å®Œæ•´æ•°æ®
- **æŸ¥è¯¢å‚æ•°**ï¼š

- `format`: å¯¼å‡ºæ ¼å¼ï¼ˆå¦‚"json"ã€"csv"ï¼‰



- **å“åº”**ï¼šå®Œæ•´çš„ä»»åŠ¡æ•°æ®æ–‡ä»¶


## 6. å®æ—¶é€šçŸ¥æ¥å£

### 6.1 WebSocketè¿æ¥

```plaintext
WebSocket /ws/tasks/{task_id}
```

- **åŠŸèƒ½**ï¼šå»ºç«‹WebSocketè¿æ¥ï¼Œæ¥æ”¶ä»»åŠ¡çš„å®æ—¶æ›´æ–°
- **æ¶ˆæ¯ç±»å‹**ï¼š

- æ¨¡å‹æ›´æ–°é€šçŸ¥
- æ–°æ¨èè®¾è®¡ç‚¹
- ä¼˜åŒ–è¿›åº¦æ›´æ–°





è¿™äº›æ¥å£è¦†ç›–äº†å‰ç«¯BOä¼˜åŒ–å™¨GUIä¸åç«¯BOå¼•æ“ä¹‹é—´æ‰€éœ€çš„ä¸»è¦äº¤äº’åŠŸèƒ½ï¼Œæ”¯æŒå®Œæ•´çš„è´å¶æ–¯ä¼˜åŒ–å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬å‚æ•°ç©ºé—´å®šä¹‰ã€ç­–ç•¥é…ç½®ã€å®éªŒè®¾è®¡ç”Ÿæˆã€ç»“æœæäº¤ã€æ¨¡å‹åˆ†æä»¥åŠå¤šç›®æ ‡ä¼˜åŒ–ç­‰åŠŸèƒ½ã€‚


## âœ… ç¡®è®¤ç‚¹

| æ¨¡å— | è¯„ä»· |
|------|------|
| ğŸ”§ å‚æ•°ç©ºé—´ä¸ç›®æ ‡é…ç½® | âœ… éå¸¸æ¸…æ™°ï¼Œæ”¯æŒå¤šå˜é‡ç±»å‹å’Œå¤æ‚çº¦æŸ |
| ğŸ§  ç­–ç•¥ä¸ç®—æ³•é…ç½® | âœ… æ”¯æŒ LHSã€é‡‡é›†å‡½æ•°é€‰æ‹©ã€æ ¸å‡½æ•°åˆ‡æ¢ï¼Œé¢„ç•™å¤šç›®æ ‡ä¼˜åŒ–é…ç½® |
| ğŸ¯ å®éªŒè®¾è®¡ä¸æ¨è | âœ… åŒºåˆ†åˆå§‹ç‚¹ä¸æ¨èç‚¹ï¼Œè¿”å›é‡‡é›†å‡½æ•°è§£é‡Šï¼ˆreasonï¼‰éå¸¸æ£’ |
| ğŸ“ˆ æ¨¡å‹è¯„ä¼°ä¸å¯è§†åŒ– | âœ… è€ƒè™‘äº†é¢„æµ‹å€¼ vs å®é™…å€¼çš„å·®å¼‚åˆ†æï¼Œæ”¯æŒ RÂ²ã€RMSEã€Paretoå‰æ²¿ç­‰å¤šç§æŒ‡æ ‡ |
| ğŸ“¦ ä»»åŠ¡ç®¡ç† | âœ… æ”¯æŒä»»åŠ¡çŠ¶æ€è¿½è¸ªã€å¯¼å‡ºã€WebSocket å®æ—¶è¿æ¥ |
| ğŸ’¬ å¯æ‰©å±•æ€§ | âœ… å¯ç”¨äºç‹¬ç«‹éƒ¨ç½²ã€å‰ç«¯æ¡†æ¶æ— å…³ï¼Œå¯å¯¹æ¥ Canvas ä¹Ÿèƒ½ç”¨äº CLI/è„šæœ¬è¿è¡Œ |

---

## ğŸŒ± è¡¥å……å»ºè®®ï¼ˆOptionalï¼‰

### âœ… 1. å¢åŠ  `/api/tasks/{task_id}/restart` æ¥å£
- **åŠŸèƒ½**ï¼šä¸­æ–­ä»»åŠ¡åï¼Œé‡å¯æŸä¸ª BO å®éªŒä»»åŠ¡ï¼ˆç”¨äº Canvas ä¸­æ–­æ¢å¤ï¼‰
- **å¯é€‰å­—æ®µ**ï¼š
```json
{
  "strategy": "reuse_last" | "reset",
  "preserve_history": true
}
```

---

### âœ… 2. ä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªæŒä¹…åŒ–ç›®å½•æˆ–æ•°æ®åº“è¡¨
ä½ çš„è®¾è®¡ä¸­é»˜è®¤äº† `task_id` æ˜¯ä¸»é”®ï¼Œå»ºè®®ï¼š
- æ‰€æœ‰è®¾è®¡ç‚¹ã€ç»“æœã€æ¨¡å‹çŠ¶æ€ä¿å­˜åœ¨ï¼š
  ```
  /data/tasks/{task_id}/
      â”œâ”€â”€ parameter_space.json
      â”œâ”€â”€ strategy.json
      â”œâ”€â”€ history.csv
      â”œâ”€â”€ model.pkl
      â””â”€â”€ log.json
  ```
- æ–¹ä¾¿è°ƒè¯• + å¯å¤ç° + Canvas å¯ä»¥æŒ‰éœ€åŠ è½½

---

### âœ… 3. æ”¯æŒå¼‚æ­¥è®¡ç®—ï¼ˆå»ºè®®ä¸ WebSocket ååŒï¼‰
- æŸäº›åç«¯æ¨¡å‹ï¼ˆå¦‚ multi-objective + qEIï¼‰è®¡ç®—è¾ƒé‡ï¼Œæ¥å£å“åº”ä¸é€‚åˆåŒæ­¥ã€‚
- å»ºè®®å¼•å…¥ **ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚ Celery + Redisï¼‰**ï¼Œå¹¶é€šè¿‡ WebSocket æ¨é€å®Œæˆäº‹ä»¶ã€‚

---

### âœ… 4. å¢åŠ  `/api/diagnostics/{task_id}` æ¥å£
ç”¨äºè°ƒè¯•ç³»ç»Ÿä¸­æ–­æˆ–æ— å“åº”æ—¶ï¼š
```json
{
  "parameter_space": "valid",
  "model_trained": true,
  "recent_exception": null,
  "pending_experiments": [],
  "last_recommendation_time": "2025-04-22T10:30:00Z"
}
```

---

## âœ… æ€»ç»“ï¼šä½ å·²å…·å¤‡ä¸€ä¸ªä¼˜ç§€çš„å¾®æœåŠ¡æ¶æ„è§„èŒƒï¼Œä¾¿äºæœªæ¥å¯¹æ¥ï¼š

- ğŸ“¦ Canvas / Streamlit å‰ç«¯
- ğŸ” Prefect / Argo æµç¨‹æ§åˆ¶
- ğŸ” æ•°æ®æ¹–æˆ–å…ƒæ•°æ®å¹³å°
- â˜ï¸ äº‘ç«¯éƒ¨ç½²ï¼ˆLambda / ECSï¼‰

å‚æ•°ç©ºé—´åˆ›å»ºè¯·æ±‚çš„æ­£ç¡®æ ¼å¼ï¼š
curl -X POST http://localhost:8000/api/parameter-space -H "Content-Type: application/json" -d '{"name":"Test Parameter Space","description":"Test parameter space for optimization","parameters":{"x1":{"name":"x1","type":"continuous","min":0.0,"max":10.0,"description":"Continuous parameter"},"x2":{"name":"x2","type":"discrete","min":1,"max":5,"description":"Integer parameter"},"x3":{"name":"x3","type":"categorical","values":["A","B","C"],"description":"Categorical parameter"}},"objectives":{"y1":{"name":"y1","type":"minimize","bounds":[0,100]}}}'

